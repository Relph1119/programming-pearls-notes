# 第4章 编写正确的程序

## 4.1 二分搜索的挑战

**问题描述：**

在确定排序后的数组$x[0..n-1]$中是否包含目标元素$t$。已知$n \geqslant 0$且$x[0] \leqslant x[1] \leqslant x[2] \leqslant \cdots \leqslant x[n-1]$，当$n=0$时，数组为空，$t$与$x$中元素的数据类型相同。

> 虽然第一篇二分搜索的论文在1946年就发表了，但是第一个没有错误的二分搜索程序却直到1962年才出现。

## 4.2 编写程序


```python
def binary_search(x, n, t):
    l = 0
    u = n - 1
    while l < u: # 循环不变式
        if l > u:
            p = -1
            break
        m = (l + u) // 2
        if x[m] < t:
            l = m + 1
        elif x[m] == t:
            p = m
            break
        else:
            u = m - 1
    return p
```


```python
x = [1, 3, 4, 5, 7, 12, 16, 17, 29, 35, 46, 52]
```


```python
p = binary_search(x, len(x), 12)
x[p]
```




    12



## 4.3 理解程序

- 初始化：循环初次执行时候，不变式为真。
- 保持：如果在某次迭代开始的时候以及循环体执行的时候，不变式都为真，那么，循环体执行完毕的时候，不变式依然为真。
- 终止：循环能够终止，并且可以得到期望的结果。

## 4.4 原理

- 断言：输入、程序变量和输出之间的关系勾勒出了程序的“状态”。
- 顺序控制结构：通过在语句之间添加断言，并分别分析程序执行的每一步来理解。
- 选择控制结构：包括不同形式的`if`和`case`语句。
- 迭代控制结构：证明循环的正确性的3个性质是初始化、保持、终止。
- 函数：使用两个断言，前置条件（在调用该函数之前就应该成立的状态）和后置条件（由函数在终止执行时保证）。

> 契约：如果在前置条件满足的情况下调用函数，函数的执行将确立后置条件，一旦证明函数体具有该性质，在以后的应用中，可以直接使用前置条件和后置条件之间的关系，而不再需要考虑其实现，该方法在软件开发中通常称为“契约编程”。
